<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buster League Draft 2026 - Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .header {
            background: linear-gradient(135deg, #c41e3a 0%, #d94e59 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }
        .nav-button {
            padding: 12px 24px;
            background: white;
            color: #c41e3a;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .nav-button:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .draft-status {
            background: white;
            color: #333;
            padding: 20px 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }
        .draft-status-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .current-pick { font-size: 1.5em; font-weight: 700; color: #c41e3a; }
        .pick-info { font-size: 1.1em; color: #6c757d; }
        .draft-history {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }
        .draft-history h2 { margin-bottom: 15px; color: #1e3c72; }
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .filter-group label { font-weight: 600; color: #495057; }
        select {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        select:hover { border-color: #c41e3a; }
        select:focus {
            outline: none;
            border-color: #c41e3a;
            box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.1);
        }
        .draft-picks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }
        .pick-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #c41e3a;
            font-size: 0.9em;
        }
        .pick-number { font-weight: 700; color: #c41e3a; }
        .undo-button {
            padding: 10px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        .undo-button:hover { background: #c82333; }
        .undo-button:disabled { background: #6c757d; cursor: not-allowed; }
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 15px; }
        }
    
        .team-item {
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            background: #f8f9fa;
            border: 2px solid transparent;
            transition: all 0.3s;
            font-size: 0.95em;
        }

        .team-item.current-turn {
            background: #c41e3a;
            color: white;
            font-weight: 700;
            border-color: #c41e3a;
            
            font-size: 1.1em;
        }



        /* Dropdown nav */
        .nav-buttons { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .dropdown { position: relative; }
        .dropdown-menu {
            display: none;
            position: absolute;
            top: calc(100% + 6px);
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            z-index: 200;
            min-width: 180px;
            padding: 6px;
            grid-template-columns: 1fr 1fr 1fr;
        }
        .dropdown-menu.open { display: grid !important; }
        .dropdown-item {
            padding: 9px 14px;
            text-decoration: none;
            color: #1e3c72;
            font-weight: 700;
            font-size: 0.9em;
            border-radius: 6px;
            transition: all 0.15s;
            text-align: center;
            display: block;
        }
        .dropdown-item:hover { background: #c41e3a; color: white; }


        .avail-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px 14px;
            border: 1px solid #e9ecef;
            transition: border-color 0.2s;
        }
        .avail-card:hover { border-color: #c41e3a; }
        .avail-pos {
            font-weight: 800;
            font-size: 0.85em;
            color: #1e3c72;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 6px;
        }
        .avail-counts {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 6px;
        }
        .avail-counts span { font-size: 0.75em; color: #6c757d; font-weight: 400; }
        .avail-bar-bg {
            height: 5px;
            background: #dee2e6;
            border-radius: 3px;
            overflow: hidden;
        }
        .avail-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.4s ease;
        }
    </style>
    <!-- Firebase Configuration -->
    <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyBpsal5vJ1b4nEjAfyQH1baKFRcuPV4QxI",
      authDomain: "buster-league-draft.firebaseapp.com",
      databaseURL: "https://buster-league-draft-default-rtdb.firebaseio.com",
      projectId: "buster-league-draft",
      storageBucket: "buster-league-draft.firebasestorage.app",
      messagingSenderId: "410413976342",
      appId: "1:410413976342:web:2ed683daa1c808a2aa9e37",
      measurementId: "G-DNJ7MC9VLW"
    };

    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, set, get, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.firebaseApp = app;
    window.firebaseDB = db;
    window.firebaseRef = ref;
    window.firebaseSet = set;
    window.firebaseGet = get;
    window.firebaseOnValue = onValue;
    window.firebaseInitialized = true;
    console.log('Firebase initialized');
    </script>
    <script src="draft-utils.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>⚾ Buster League Draft 2026</h1>
                <p>Dashboard</p>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <a href="draft.html" class="nav-button" id="draft-board-btn" style="display:none;">Draft Board →</a>
                <a href="login.html" class="nav-button secondary">Team Login</a>
                </div>
            </div>
        </div>

        <div class="draft-status">
            <div class="draft-status-content">
                <div class="current-pick">
                    <span id="current-pick-text">Pick 1 - PHI is on the clock</span>
                </div>
                <div class="pick-info">
                    Round <span id="current-round">1</span> • Pick <span id="current-pick-number">1</span> of <span id="total-picks">20</span>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 220px 1fr; gap: 20px; align-items: start;">

            <!-- Left: Draft Order -->
            <div style="background: white; border-radius: 12px; padding: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.2); position: sticky; top: 20px;">
                <h2 style="margin-bottom: 12px; color: #1e3c72; font-size: 1em; font-weight: 700; border-bottom: 2px solid #c41e3a; padding-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;">Draft Order</h2>
                <div id="draft-order-list"></div>
            </div>

            <!-- Right: Draft History + Rosters -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <div class="draft-history">
                    <h2>Draft History (<span id="total-drafted">0</span> players drafted)</h2>
                    <div class="draft-picks-grid" id="draft-history"></div>
                </div>


                <div class="draft-history" id="available-players-section">
                    <h2>Available Players</h2>
                    <div id="available-players-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin-top: 10px;"></div>
                </div>
                <div class="draft-history" id="rostered-players-section">
                    <h2>Rostered Players</h2>
                    <div id="rostered-players-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin-top: 10px;"></div>
                </div>

                <div class="draft-history">
                    <h2>Team Rosters</h2>
                    <div class="controls">
                        <div class="filter-group">
                            <label for="roster-team-filter">View Team:</label>
                            <select id="roster-team-filter" onchange="renderRosters()">
                                <option value="all">All Teams</option>
                            </select>
                        </div>
                    </div>
                    <div id="team-rosters"></div>
                </div>
            </div>

        </div>
    </div>

 <script>
// Shared data management via localStorage
        function saveDraftState() {
            localStorage.setItem('busterLeagueDraft', JSON.stringify({
                draftedPlayers: draftedPlayers,
                currentPickIndex: currentPickIndex
            }));
        }
        // Team names in draft order

        // Initialize with embedded data
        let players = [];
        let draftedPlayers = [];
        let currentPickIndex = 0;        function renderDraftHistory() {
            console.log('renderDraftHistory called, draftedPlayers:', draftedPlayers);
            const historyDiv = document.getElementById('draft-history');
            if (!historyDiv) {
                console.error('draft-history element not found');
                return;
            }
            console.log('Found draft-history div:', historyDiv);
            
            const totalDraftedElem = document.getElementById('total-drafted');
            if (totalDraftedElem) {
                totalDraftedElem.textContent = draftedPlayers.length;
                console.log('Updated total-drafted to:', draftedPlayers.length);
            }
            
            const undoButton = document.getElementById('undo-button');
            if (undoButton) {
                undoButton.disabled = draftedPlayers.length === 0;
            }
            
            if (draftedPlayers.length === 0) {
                console.log('No picks yet, showing placeholder');
                historyDiv.innerHTML = '<p style="color: #6c757d;">No picks yet</p>';
                return;
            }
            
            console.log('Generating HTML for', draftedPlayers.length, 'picks');
            
            const html = draftedPlayers.slice().reverse().map(pick => {
                const position = getPlayerPosition(pick.player);
                return `
                    <div class="pick-item">
                        <div class="pick-number">Pick ${pick.pickNumber} (Round ${pick.round})</div>
                        <div style="font-weight: 600; margin: 5px 0;">${pick.player.First} ${pick.player.Last}</div>
                        <div style="color: #6c757d; font-size: 0.9em;">
                            ${pick.team} • ${position.toUpperCase()} • ${pick.player.Team || 'FA'}
                        </div>
                    </div>
                `;
            }).join('');
            
            historyDiv.innerHTML = html;
        }

        function renderRosters() {
            console.log('renderRosters called');
            const rostersDiv = document.getElementById('team-rosters');
            if (!rostersDiv) {
                console.error('team-rosters element not found');
                return;
            }
            const selectedTeam = document.getElementById('roster-team-filter').value;
            
            // Position requirements
            const requirements = {
                'C': 3, 'SP': 8, 'RP': 8,
                '1B': 2, '2B': 2, '3B': 2, 'SS': 2,
                'LF': 2, 'CF': 2, 'RF': 2, 'DH': 2
            };
            
            // Build rosters for each team
            const rosters = {};
            teams.forEach(team => {
                rosters[team] = {
                    preDrafted: [],
                    drafted: [],
                    positionCounts: {}
                };
                // Initialize position counts
                Object.keys(requirements).forEach(pos => {
                    rosters[team].positionCounts[pos] = 0;
                });
            });
            
            // Add pre-drafted players
            players.forEach(player => {
                if (isPreDrafted(player)) {
                    const teamKey = player.Team.toUpperCase();
                    if (rosters[teamKey]) {
                        rosters[teamKey].preDrafted.push(player);
                        getEligiblePositions(player).forEach(function(pos) {
                            const key = pos.toUpperCase();
                            if (rosters[teamKey].positionCounts[key] !== undefined) {
                                rosters[teamKey].positionCounts[key]++;
                            }
                        });
                    }
                }
            });
            
            // Add drafted players
            draftedPlayers.forEach(pick => {
                if (rosters[pick.team]) {
                    rosters[pick.team].drafted.push(pick);
                    getEligiblePositions(pick.player).forEach(function(pos) {
                        const key = pos.toUpperCase();
                        if (rosters[pick.team].positionCounts[key] !== undefined) {
                            rosters[pick.team].positionCounts[key]++;
                        }
                    });
                }
            });
            
            // Filter teams if needed
            const teamsToShow = selectedTeam === 'all' ? teams : [selectedTeam];
            
            // Generate HTML
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;">';
            
            teamsToShow.forEach(team => {
                const roster = rosters[team];
                const totalPlayers = roster.preDrafted.length + roster.drafted.length;
                
                html += `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 2px solid #dee2e6;">
                        <h3 style="color: #1e3c72; margin-bottom: 10px; border-bottom: 2px solid #c41e3a; padding-bottom: 8px;">
                            ${team} (${totalPlayers} players)
                        </h3>
                `;
                
                // Position requirements display
                html += '<div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 15px; border: 1px solid #dee2e6;">';
                html += '<strong style="color: #1e3c72; font-size: 0.9em; display: block; margin-bottom: 8px;">POSITION NEEDS:</strong>';
                html += '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; font-size: 0.85em;">';
                
                // Group positions for display
                const positionGroups = [
                    { label: 'C', pos: 'C' },
                    { label: 'SP', pos: 'SP' },
                    { label: 'RP', pos: 'RP' },
                    { label: '1B', pos: '1B' },
                    { label: '2B', pos: '2B' },
                    { label: '3B', pos: '3B' },
                    { label: 'SS', pos: 'SS' },
                    { label: 'LF', pos: 'LF' },
                    { label: 'CF', pos: 'CF' },
                    { label: 'RF', pos: 'RF' },
                    { label: 'DH', pos: 'DH' }
                ];
                
                positionGroups.forEach(pg => {
                    const current = roster.positionCounts[pg.pos];
                    const needed = requirements[pg.pos];
                    const remaining = needed - current;
                    const isComplete = remaining <= 0;
                    const color = current < 2 ? '#dc3545' : (isComplete ? '#28a745' : (remaining <= 1 ? '#ffc107' : '#dc3545'));
                    
                    html += `<div style="padding: 3px 0;">
                        <span style="font-weight: 600;">${pg.label}:</span> 
                        <span style="color: ${color}; font-weight: 700;">${current}/${needed}</span>
                        ${!isComplete ? `<span style="color: #6c757d; font-size: 0.9em;"> (need ${remaining})</span>` : ' ✔'}
                    </div>`;
                });
                
                html += '</div></div>';
                
                // Position summary box
                html += '<div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 15px; border: 1px solid #dee2e6;">';
                html += '<strong style="color: #1e3c72; font-size: 0.9em; display: block; margin-bottom: 8px;">POSITION BREAKDOWN:</strong>';
                html += '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; font-size: 0.85em;">';
                
                // Count all positions (keys are uppercase)
                const allPositions = ['C', 'SP', 'RP', '1B', '2B', '3B', 'SS', 'LF', 'CF', 'RF', 'DH'];
                
                allPositions.forEach(pos => {
                    const count = roster.positionCounts[pos] || 0;
                    html += `<div style="padding: 3px 0;">
                        <span style="font-weight: 600;">${pos}:</span> 
                        <span style="color: #1e3c72; font-weight: 700;">${count}</span>
                    </div>`;
                });
                
                html += '</div></div>';
                
                // Players list
                const allPlayers = [
                    ...roster.preDrafted.map(p => ({ player: p, type: 'keeper', pickNumber: null })),
                    ...roster.drafted.map(d => ({ player: d.player, type: 'drafted', pickNumber: d.pickNumber }))
                ];
                
                if (allPlayers.length > 0) {
                    html += '<div style="margin-bottom: 15px;">';
                    html += '<strong style="color: #6c757d; font-size: 0.9em;">ROSTER:</strong>';
                    
                    allPlayers.forEach(item => {
                        const eligiblePositions = getEligiblePositions(item.player);
                        const posDisplay = eligiblePositions.map(p => p.toUpperCase()).join('/');
                        const typeLabel = item.type === 'keeper' ? 
                            '<span style="background: #28a745; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.75em; margin-left: 5px;">K</span>' : 
                            `<span style="color: #6c757d; font-size: 0.85em;"> (Pick ${item.pickNumber})</span>`;
                        
                        html += `<div style="padding: 5px 0; font-size: 0.9em; border-bottom: 1px solid #e9ecef;">
                            ${item.player.First} ${item.player.Last} 
                            <span style="color: #c41e3a; font-weight: 600;">${posDisplay}</span>
                            ${typeLabel}
                        </div>`;
                    });
                    
                    html += '</div>';
                }
                
                if (totalPlayers === 0) {
                    html += '<div style="color: #6c757d; font-style: italic; padding: 10px 0;">No players yet</div>';
                }
                
                html += '</div>';
            });
            
            html += '</div>';
            rostersDiv.innerHTML = html;
        }


        function renderAll() {
            updateDraftStatus();
            renderDraftOrder(20);
            renderDraftHistory();
            renderRosters();
        }


        // Event listeners (only attach if elements exist)
        const posFilter = document.getElementById('position-filter');
        if (posFilter) posFilter.addEventListener('change', renderPlayers);
        
        const searchInput = document.getElementById('search');
        if (searchInput) searchInput.addEventListener('input', renderPlayers);
        
        const showDrafted = document.getElementById('show-drafted');
        if (showDrafted) showDrafted.addEventListener('change', renderPlayers);

        // Initialize when page loads
        
        // Auto-sync when data changes in another tab/window
        window.addEventListener('storage', function(e) {
            if (e.key === 'busterLeagueDraft' && e.newValue) {
                console.log('Draft data changed in another tab, reloading...');
                loadDraftState();
                renderAll();
                renderAvailablePlayers();
                renderRosteredPlayers();
            }
        });
        
        // Also check on page focus (when you switch back to this tab)
        window.addEventListener('focus', function() {
            console.log('Page focused, checking for updates...');
            loadDraftState();
            renderAll();
            renderAvailablePlayers();
            renderRosteredPlayers();
        });


        const STARTING_COUNTS = {"SP": 107, "RP": 146, "C": 46, "1B": 24, "2B": 32, "3B": 33, "SS": 21, "LF": 25, "CF": 25, "RF": 29, "DH": 12};

        function renderAvailablePlayers() {
            const grid = document.getElementById('available-players-grid');
            if (!grid) return;

            const draftedKeys = new Set(draftedPlayers.map(d =>
                d.player.First + '|' + d.player.Last + '|' + d.player.Age
            ));

            const remaining = {};
            Object.keys(STARTING_COUNTS).forEach(p => remaining[p] = 0);

            players.forEach(p => {
                if (p.Team) return;
                const key = p.First + '|' + p.Last + '|' + p.Age;
                if (draftedKeys.has(key)) return;
                const pos = (p.P || 'UTIL').toUpperCase();
                if (remaining[pos] !== undefined) remaining[pos]++;
            });

            const posOrder = ['SP','RP','C','1B','2B','3B','SS','LF','CF','RF','DH'];
            const colors = {
                SP: '#2a5298', RP: '#1e3c72', C: '#c41e3a',
                '1B': '#28a745', '2B': '#20c997', '3B': '#17a2b8', SS: '#6f42c1',
                LF: '#fd7e14', CF: '#e83e8c', RF: '#dc3545', DH: '#6c757d'
            };

            grid.innerHTML = posOrder.map(pos => {
                const total = STARTING_COUNTS[pos] || 0;
                const left  = remaining[pos] || 0;
                const pct   = total > 0 ? Math.round((left / total) * 100) : 0;
                const color = colors[pos] || '#6c757d';
                return '<div class="avail-card">' +
                    '<div class="avail-pos">' + pos + '</div>' +
                    '<div class="avail-counts">' + left + ' <span>/ ' + total + '</span></div>' +
                    '<div class="avail-bar-bg"><div class="avail-bar-fill" style="width:' + pct + '%;background:' + color + '"></div></div>' +
                    '</div>';
            }).join('');
        }

                function renderRosteredPlayers() {
            const grid = document.getElementById('rostered-players-grid');
            if (!grid) return;

            const posOrder = ['SP','RP','C','1B','2B','3B','SS','LF','CF','RF','DH'];
            const colors = {
                SP: '#2a5298', RP: '#1e3c72', C: '#c41e3a',
                '1B': '#28a745', '2B': '#20c997', '3B': '#17a2b8', SS: '#6f42c1',
                LF: '#fd7e14', CF: '#e83e8c', RF: '#dc3545', DH: '#6c757d'
            };

            // Count keepers + drafted players per position
            const counts = {};
            posOrder.forEach(p => counts[p] = 0);

            players.forEach(p => {
                if (!p.Team) return; // not a keeper
                const pos = (p.P || 'UTIL').toUpperCase();
                if (counts[pos] !== undefined) counts[pos]++;
            });

            draftedPlayers.forEach(d => {
                const pos = (d.player.P || 'UTIL').toUpperCase();
                if (counts[pos] !== undefined) counts[pos]++;
            });

            const total = Object.values(counts).reduce((a, b) => a + b, 0);

            grid.innerHTML = posOrder.map(pos => {
                const n = counts[pos] || 0;
                const color = colors[pos] || '#6c757d';
                return '<div class="avail-card">' +
                    '<div class="avail-pos">' + pos + '</div>' +
                    '<div class="avail-counts" style="color:' + color + '">' + n + '</div>' +
                    '<div style="font-size:0.75em;color:#6c757d;margin-top:2px;">' +
                        (total > 0 ? Math.round((n / total) * 100) + '% of roster' : 'â€”') +
                    '</div>' +
                    '</div>';
            }).join('');
        }

                // Dropdown open/close
        document.addEventListener('click', () => {
            document.querySelectorAll('.dropdown-menu.open').forEach(m => m.classList.remove('open'));
        });

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.dropdown-menu.open').forEach(m => m.classList.remove('open'));
            }
        });
        window.addEventListener('DOMContentLoaded', async () => {
            // Load player data from external file
            players = await fetch('players.json').then(r => r.json());

            // Show Draft Board only for admin
            const loggedTeam = localStorage.getItem('busterLeagueTeam');
            const draftBtn = document.getElementById('draft-board-btn');
            if (draftBtn && loggedTeam === 'ADMIN') draftBtn.style.display = '';
            loadDraftState();
            // Populate team roster dropdown
            const rosterSelect = document.getElementById('roster-team-filter');
            if (rosterSelect) {
                teams.forEach(team => {
                    const option = document.createElement('option');
                    option.value = team;
                    option.textContent = team;
                    rosterSelect.appendChild(option);
                });
            }
            
            console.log('Page loaded, rendering all...');
            renderAll();
            renderAvailablePlayers();
            renderRosteredPlayers();
        });

        // Unsanitize data from Firebase
        function unsanitizeFromFirebase(obj) {
            if (obj === null || obj === undefined) return obj;
            if (typeof obj !== 'object') return obj;
            if (Array.isArray(obj)) return obj.map(unsanitizeFromFirebase);
            
            const unsanitized = {};
            const keyMap = {
                'H_9': 'H/9', 'K_9': 'K/9', 'BB_9': 'BB/9', 'HR_9': 'HR/9'
            };
            
            for (const key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const originalKey = keyMap[key] || key;
                    unsanitized[originalKey] = unsanitizeFromFirebase(obj[key]);
                }
            }
            return unsanitized;
        }

        // ===== FIREBASE SYNC FOR DASHBOARD =====
        document.addEventListener('DOMContentLoaded', async function() {
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            if (window.firebaseInitialized) {
                try {
                    // Load drafted players
                    const snapshot = await window.firebaseGet(window.firebaseRef(window.firebaseDB, 'draftedPlayers'));
                    if (snapshot.exists()) {
                        draftedPlayers = unsanitizeFromFirebase(snapshot.val());
                        console.log('Dashboard loaded', draftedPlayers.length, 'picks');
                        renderRosters();
                    }
                    
                    // Listen for changes
                    window.firebaseOnValue(window.firebaseRef(window.firebaseDB, 'draftedPlayers'), (snapshot) => {
                        const data = unsanitizeFromFirebase(snapshot.val() || []);
                        if (JSON.stringify(data) !== JSON.stringify(draftedPlayers)) {
                            console.log('Dashboard updated -', data.length, 'picks');
                            draftedPlayers = data;
                            renderRosters();
                        }
                    });
                    
                    console.log('Dashboard sync enabled');
                } catch (error) {
                    console.error('Dashboard sync error:', error);
                }
            }
        });
    </script>
</body>
</html>